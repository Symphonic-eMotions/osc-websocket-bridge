<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSC WebSocket Client</title>
    <link rel="stylesheet" href="output.css">
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-6">

<!-- Titel -->
<h1 class="text-4xl font-bold mb-8 text-center">OSC WebSocket Client</h1>

<!-- Knoppen -->
<div class="flex space-x-4 mb-6">
    <button id="start-button" class="px-4 py-2 bg-green-500 text-white font-medium rounded shadow-md hover:bg-green-600 transition-all">
        Start
    </button>
    <button id="stop-button" disabled class="px-4 py-2 bg-red-500 text-white font-medium rounded shadow-md opacity-50 cursor-not-allowed">
        Stop
    </button>
</div>

<!-- Sliders container -->
<div id="sliders-container" class="w-full max-w-lg space-y-6 bg-gray-800 p-6 rounded-lg shadow-md">
    <!-- Sliders worden hier dynamisch toegevoegd -->
</div>

<script>
    let ws;
    const sliders = {}; // Object om sliders bij te houden per unieke OSC-stream

    // Functie om een nieuwe slider toe te voegen
    function createSlider(address) {
        const container = document.createElement('div');
        container.classList.add('flex', 'flex-col', 'space-y-2', 'bg-gray-700', 'p-4', 'rounded-md', 'shadow-md');

        const label = document.createElement('div');
        label.classList.add('text-sm', 'font-bold', 'text-gray-300');
        label.textContent = `Stream: ${address}`;
        container.appendChild(label);

        const slider = document.createElement('input');
        slider.type = 'range';
        slider.min = '0';
        slider.max = '1';
        slider.step = '0.01'; // Hiermee kun je waarden in stappen van 0.01 hebben
        slider.value = '0';
        slider.classList.add('w-full', 'cursor-pointer', 'slider-thumb');
        container.appendChild(slider);

        // Voeg de slider toe aan de sliders-container in de HTML
        document.getElementById('sliders-container').appendChild(container);

        // Sla de slider op in het `sliders` object voor snelle toegang
        sliders[address] = slider;
    }

    // Functie om een sliderwaarde bij te werken op basis van inkomende OSC-berichten
    function updateSlider(address, value) {
        if (sliders[address]) {
            sliders[address].value = value;
        } else {
            // Maak een nieuwe slider als het adres nog niet bestaat
            createSlider(address);
            sliders[address].value = value;
        }
    }

    // Start WebSocket-verbinding
    function startWebSocket() {
        ws = new WebSocket('ws://localhost:8080');

        ws.onopen = () => {
            console.log('Verbonden met WebSocket-server');
            document.getElementById('start-button').disabled = true;
            document.getElementById('stop-button').disabled = false;
            document.getElementById('stop-button').classList.remove('opacity-50', 'cursor-not-allowed');
            document.getElementById('stop-button').classList.add('hover:bg-red-600');
        };

        ws.onmessage = (event) => {
            const oscMessage = JSON.parse(event.data);
            console.log('Ontvangen OSC bericht:', oscMessage);

            // Update of maak een slider aan voor elk uniek OSC-adres
            const address = oscMessage.address;
            const args = oscMessage.args[0]; // Eerste argument, pas aan naar behoefte

            // Zorg ervoor dat de waarde tussen 0 en 1 valt, indien nodig
            const scaledValue = Math.max(0, Math.min(1, args));
            updateSlider(address, scaledValue);
        };

        ws.onclose = () => {
            console.log('WebSocket-verbinding gesloten');
            document.getElementById('start-button').disabled = false;
            document.getElementById('stop-button').disabled = true;
            document.getElementById('stop-button').classList.add('opacity-50', 'cursor-not-allowed');
            document.getElementById('stop-button').classList.remove('hover:bg-red-600');
        };
    }

    // Stop WebSocket-verbinding
    function stopWebSocket() {
        if (ws) {
            ws.close();
            console.log('WebSocket-verbinding wordt gesloten');
        }
    }

    // Event listeners voor de knoppen
    document.getElementById('start-button').addEventListener('click', startWebSocket);
    document.getElementById('stop-button').addEventListener('click', stopWebSocket);
</script>
</body>
</html>
